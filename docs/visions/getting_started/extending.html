

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Extending &mdash; visions 0.7.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Typeset testing" href="testing.html" />
    <link rel="prev" title="Problem type inference" href="examples/ml_problem_set.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> visions
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="concepts.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Extending</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#custom-type-from-scratch">Custom Type (from scratch)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#another-example">Another example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#custom-types-extend-a-type">Custom Types (extend a type)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#each-type-has-the-method-evolve-type-for-this-purpose">Each type has the method <code class="docutils literal notranslate"><span class="pre">evolve_type</span></code> for this purpose.</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#declarative-api">Declarative API</a></li>
<li class="toctree-l2"><a class="reference internal" href="#custom-typesets-from-scratch">Custom Typesets (from scratch)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#custom-typesets-extend-typeset">Custom typesets (extend typeset)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Typeset testing</a></li>
</ul>
<p class="caption"><span class="caption-text">Applications</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../applications/applications.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/summarizer.html">Data Summarization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/validation.html">Data Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/machine_learning.html">Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/compression.html">Data Compression</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/integration.html">Data Discovery and Data Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/users.html">Users</a></li>
</ul>
<p class="caption"><span class="caption-text">Contribution</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing/support.html">Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/contributing.html">Community contributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/type.html">Contributions new types to visions</a></li>
</ul>
<p class="caption"><span class="caption-text">Background</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../background/background.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../background/theory.html">Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../background/nested_set_view.html">Nested set view</a></li>
<li class="toctree-l1"><a class="reference internal" href="../background/graph_view.html">Graph view</a></li>
<li class="toctree-l1"><a class="reference internal" href="../background/about.html">About</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">visions</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Extending</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/visions/getting_started/extending.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="extending">
<h1>Extending<a class="headerlink" href="#extending" title="Permalink to this headline">¶</a></h1>
<div class="section" id="custom-type-from-scratch">
<h2>Custom Type (from scratch)<a class="headerlink" href="#custom-type-from-scratch" title="Permalink to this headline">¶</a></h2>
<p>Each <code class="docutils literal notranslate"><span class="pre">visions</span></code> type is a subclass of <code class="docutils literal notranslate"><span class="pre">VisionsBaseType</span></code> requiring a unique implementation of two methods:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">get_relations</span></code>. Returns the set of relations mapping from another type to the current type.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">contains_op</span></code>. Checks whether a series is of the type visions_type, returns Bool.</p></li>
</ol>
<p>Let’s inspect the source code for <code class="docutils literal notranslate"><span class="pre">Ordinal</span></code> to gather intuition.</p>
<div class="literal-block-wrapper docutils container" id="ordinal">
<div class="code-block-caption"><span class="caption-text">visions.types.ordinal.py</span><a class="headerlink" href="#ordinal" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">visions.types.type</span> <span class="kn">import</span> <span class="n">VisionsBaseType</span>
<span class="kn">from</span> <span class="nn">visions.types.categorical</span> <span class="kn">import</span> <span class="n">Categorical</span>


<span class="k">class</span> <span class="nc">Ordinal</span><span class="p">(</span><span class="n">VisionsBaseType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;**Ordinal** implementation of :class:`visions.types.VisionsBaseType`.</span>
<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; x = pd.Series([1, 2, 3, 1, 1], dtype=&#39;category&#39;)</span>
<span class="sd">        &gt;&gt;&gt; x in visions.Ordinal</span>
<span class="sd">        True</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_relations</span><span class="p">():</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">IdentityRelation</span><span class="p">(</span><span class="n">Categorical</span><span class="p">)]</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">contains_op</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">series</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pdt</span><span class="o">.</span><span class="n">is_categorical_dtype</span><span class="p">(</span><span class="n">series</span><span class="p">)</span> <span class="ow">and</span> <span class="n">series</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">ordered</span>
</pre></div>
</div>
</div>
<p>In this example, ordinal declares a single <code class="docutils literal notranslate"><span class="pre">IdentityRelation</span></code> from categorical. The meaning
of <code class="docutils literal notranslate"><span class="pre">IdentityRelation</span></code> is not particularly important in this case, just know it means the mapping
function between categorical and ordinal is the identity function.</p>
<p>We can also see the <code class="docutils literal notranslate"><span class="pre">contains_op</span></code> requires the sequence to be an ordered categorical machine type representation.</p>
<p>Alternatively you can choose to base a type on an existing type.
This is convenient when you only change a single relation.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Your custom type might be helpful for others, in which case you can choose to contribute it to <code class="docutils literal notranslate"><span class="pre">visions</span></code>.
Read more on <a class="reference internal" href="../contributing/type.html"><span class="doc">how to contribute</span></a>.</p>
</div>
</div>
<div class="section" id="another-example">
<h2>Another example<a class="headerlink" href="#another-example" title="Permalink to this headline">¶</a></h2>
<p>The default typesets in <code class="docutils literal notranslate"><span class="pre">visions</span></code> consider <code class="docutils literal notranslate"><span class="pre">Boolean</span></code> and <code class="docutils literal notranslate"><span class="pre">Categorical</span></code> to be distinct types.
In fact, <code class="docutils literal notranslate"><span class="pre">Boolean</span></code> is a special case of <code class="docutils literal notranslate"><span class="pre">Categorical</span></code> where the number of categories is 2 and contains the values “True” and “False” (“Man” and “Woman” wouldn’t be binary).</p>
<p>Note that for data analysis, the distinction makes sense.
For a boolean we could the true/false ratio for example.</p>
<p>See: <code class="docutils literal notranslate"><span class="pre">examples/data_analysis</span></code> for an example.</p>
</div>
<div class="section" id="custom-types-extend-a-type">
<h2>Custom Types (extend a type)<a class="headerlink" href="#custom-types-extend-a-type" title="Permalink to this headline">¶</a></h2>
<div class="admonition error">
<p class="admonition-title">Error</p>
<p>This feature has been removed, please use the declarative API</p>
</div>
<p>Another option is to create a new type based on an existing type.
This is useful for small changes, such as adding a single relation.</p>
</div>
</div>
<div class="section" id="each-type-has-the-method-evolve-type-for-this-purpose">
<h1>Each type has the method <code class="docutils literal notranslate"><span class="pre">evolve_type</span></code> for this purpose.<a class="headerlink" href="#each-type-has-the-method-evolve-type-for-this-purpose" title="Permalink to this headline">¶</a></h1>
<div class="section" id="declarative-api">
<h2>Declarative API<a class="headerlink" href="#declarative-api" title="Permalink to this headline">¶</a></h2>
<p>Another option is to create a new type using the declarative API.
We can use the <code class="docutils literal notranslate"><span class="pre">create_type</span></code> function for this purpose.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">Add a inference relation from integer to datetime (YYYYMMDD)</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="kn">from</span> <span class="nn">visions</span> <span class="kn">import</span> <span class="n">create_type</span>
 <span class="kn">from</span> <span class="nn">visions.types.date_time</span> <span class="kn">import</span> <span class="n">DateTime</span>
 <span class="kn">from</span> <span class="nn">visions.types.generic</span> <span class="kn">import</span> <span class="n">Generic</span>


 <span class="k">def</span> <span class="nf">integer_is_mydatetime</span><span class="p">(</span><span class="n">series</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
     <span class="k">return</span> <span class="n">test_utils</span><span class="o">.</span><span class="n">coercion_test</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">func</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)))(</span><span class="n">series</span><span class="p">)</span>


 <span class="k">def</span> <span class="nf">integer_to_mydatetime</span><span class="p">(</span><span class="n">series</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
     <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">series</span><span class="p">)</span>


 <span class="n">MyDateTime</span> <span class="o">=</span> <span class="n">create_type</span><span class="p">(</span>
     <span class="s2">&quot;MyDateTime&quot;</span><span class="p">,</span>
     <span class="n">contains</span><span class="o">=</span><span class="n">DateTime</span><span class="o">.</span><span class="n">contains_op</span><span class="p">,</span>
     <span class="n">identity</span><span class="o">=</span><span class="n">Generic</span><span class="p">,</span>
     <span class="n">inference</span><span class="o">=</span><span class="n">InferenceRelation</span><span class="p">(</span>
         <span class="n">relationship</span><span class="o">=</span><span class="n">integer_is_mydatetime</span><span class="p">,</span>
         <span class="n">transformer</span><span class="o">=</span><span class="n">integer_to_mydatetime</span><span class="p">,</span>
         <span class="n">related_type</span><span class="o">=</span><span class="n">Integer</span><span class="p">,</span>
     <span class="p">)</span>
 <span class="p">)</span>

 <span class="nb">print</span><span class="p">(</span><span class="n">MyDateTime</span><span class="p">)</span>
 <span class="c1"># Prints: MyDateTime</span>
</pre></div>
</div>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>While developing new type relations, you can use this helper function to debug:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">column</span><span class="p">,</span> <span class="n">type_before</span><span class="p">,</span> <span class="n">type_after</span> <span class="ow">in</span> <span class="n">compare_detect_inference_frame</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">typeset</span><span class="p">):</span>
     <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2"> was </span><span class="si">{</span><span class="n">type_before</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="n">type_after</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Please read the <code class="docutils literal notranslate"><span class="pre">Type</span> <span class="pre">changes</span></code> section in the <a class="reference internal" href="../api/functional.html"><span class="doc">functional API documentation</span></a> for more details.</p>
</div>
</div>
<div class="section" id="custom-typesets-from-scratch">
<h2>Custom Typesets (from scratch)<a class="headerlink" href="#custom-typesets-from-scratch" title="Permalink to this headline">¶</a></h2>
<p>Although <code class="docutils literal notranslate"><span class="pre">visions</span></code> comes with an array of starter typesets suitable for most standard usage
you may quickly find yourself looking to expand upon those types to suit your own domain specific
needs. In order to meet those needs there are a number of easy mechanisms to either extend pre-existing
typesets or define your own from scratch.</p>
<p>For example, you could define a custom typeset with only time specific types as follows:</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Custom time typeset</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CustomSet</span><span class="p">(</span><span class="n">VisionTypeset</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Typeset that exclusively supports time related types</span>

<span class="sd">    Includes support for the following types:</span>

<span class="sd">    - DateTime</span>
<span class="sd">    - TimeDelta</span>
<span class="sd">    - Date</span>
<span class="sd">    - Time</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">types</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">DateTime</span><span class="p">,</span>
            <span class="n">TimeDelta</span><span class="p">,</span>
            <span class="n">Date</span><span class="p">,</span>
            <span class="n">Time</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">types</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>or even more simply,</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">Custom time typeset (simplified)</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">visions</span> <span class="k">as</span> <span class="nn">v</span>
<span class="n">types</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">DateTime</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">TimeDelta</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">Date</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">Time</span><span class="p">]</span>
<span class="n">CustomSet</span> <span class="o">=</span> <span class="n">VisionTypeset</span><span class="p">(</span><span class="n">types</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="custom-typesets-extend-typeset">
<h2>Custom typesets (extend typeset)<a class="headerlink" href="#custom-typesets-extend-typeset" title="Permalink to this headline">¶</a></h2>
<p>Alternatively, typesets support a limited algebra allowing you to define new typesets
based on simple manipulations to pre-existing sets.</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">Custom time typeset</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">visions</span> <span class="k">as</span> <span class="nn">v</span>
<span class="n">typeset</span> <span class="o">=</span> <span class="n">CompleteSet</span><span class="p">()</span> <span class="o">-</span> <span class="n">v</span><span class="o">.</span><span class="n">Time</span> <span class="o">+</span> <span class="n">v</span><span class="o">.</span><span class="n">Date</span>

<span class="c1"># Alternatively</span>
<span class="n">typeset</span> <span class="o">=</span> <span class="n">typeset</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">Time</span><span class="p">,</span> <span class="n">v</span><span class="o">.</span><span class="n">Date</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Just like addition and subtraction elsewhere in Python, you can split these operations up
in any way imaginable:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">visions</span> <span class="k">as</span> <span class="nn">v</span>
<span class="n">rdw_typeset</span> <span class="o">=</span> <span class="n">CompleteSet</span><span class="p">()</span>
<span class="n">rdw_typeset</span> <span class="o">-=</span> <span class="n">v</span><span class="o">.</span><span class="n">Boolean</span>
<span class="n">rdw_typeset</span> <span class="o">+=</span> <span class="n">BooleanNL</span>
<span class="n">rdw_typeset</span> <span class="o">-=</span> <span class="n">v</span><span class="o">.</span><span class="n">Integer</span>
<span class="n">rdw_typeset</span> <span class="o">+=</span> <span class="n">DateTimeIntYYYYMMDD</span>
<span class="n">rdw_typeset</span> <span class="o">-=</span> <span class="n">v</span><span class="o">.</span><span class="n">Categorical</span>
<span class="n">rdw_typeset</span> <span class="o">+=</span> <span class="n">CategoricalStr</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="testing.html" class="btn btn-neutral float-right" title="Typeset testing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="examples/ml_problem_set.html" class="btn btn-neutral float-left" title="Problem type inference" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Ian Eaves and Simon Brugman.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>